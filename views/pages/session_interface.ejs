<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Cần thiết cho 1 web -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->

  <link rel="stylesheet" href="index&manage.css">
  <link rel="stylesheet" href="./bootstrap/bootstrap-4.0.0.min.js">
  <link rel="stylesheet" href="./bootstrap/bootstrap.min.css">


  <title>Hiển thị phiên hỏi đáp</title>

  <!-- Thư viện online cho Bootstrap -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script src = "https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>
</head>


<body style="background-color: #EEEEEE">

<%- include header %>

<!-- MAIN -->
  <main role="main">

    <div class="container marketing">
      <br>
      <div class="card" style="border-radius: 6px;">
        <div class="card-header" style="background-color: #888;border-top-left-radius: 6px;border-top-right-radius: 6px;">
          <h5><b>Phiên hỏi đáp</b></h5>
        </div>
        <div class="card-body" style="background-color: #dddddd;border-bottom-left-radius: 6px;border-bottom-right-radius: 6px;">
          <div class="row padding">
            <div class="col-3 col-sm-2 col-md-2">
              <div class="card" style="border-radius: 6px;">
                <img class="card-img-top" src="./images/avatar2.jpg" style="border-radius: 6px;">
              </div>
            </div>
            <div class="col-9 col-sm-9 col-md-9">
              <div class="card-body" style="margin-top: -20px;">
                <h4 class="card-title"><%=sections[0][0].sec_title%></h4>
                <p class="card-text"><%=sections[0][0].sec_desc%><br>
                  Đăng bởi: <a href="/yourprofile?id=<%=sections[0][0].user_id%>"><%=sections[0][0].name%></a><br>
                  Thời gian tạo: <%=sections[0][0].sec_time%>
                </p>
                <% if (sections[0][0].username == session.username) { %>
                <%if (sections[0][0].sec_isopen==0){%>
                 <p class="form-inline" >   
                  <a href="/openqa?id=<%=sections[0][0].section_id%>" class="btn btn-secondary" role="button">Mở lại phiên hỏi đáp</a>
                </p>
                <%} else {%>
                <p class="form-inline" >
                  <a href="/closeqa?id=<%=sections[0][0].section_id%>" class="btn btn-secondary" role="button">Đóng phiên hỏi đáp</a>
                </p>
                <%}}%>
              </div>
            </div>
             <%if(session.username==sections[0][0].username){%>
              <div class=" col-1 dropdown" >
                <button class="btn dropdown-toggle"  type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item" data-toggle="modal" data-target="#updatesection" href="#updatesection">Sửa</a>
                  <a class="dropdown-item" href="/deleteqa?id=<%=sections[0][0].section_id%>">Xóa</a>
                </div>
              </div>
            <%}%>
          </div>
        </div>
      </div><br>
 <div class="modal fade" id="updatesection" tabindex="-1" role="dialog" aria-labelledby="SectionModalLabel" aria-hidden="true">
                                 <div class="modal-dialog" role="document">
                                     <div class="modal-content">
                                         <div class="modal-header">
                                           <h5 class="modal-title" id="SessionModalLabel">Chỉnh sửa phiếu khảo sát</h5>
                                             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                 <span aria-hidden="true">&times;</span>
                                             </button>
                                         </div>
                                         <div class="modal-body">
                                               <form action="/upsec?id=<%=sections[0][0].section_id%>" method="POST">
                                                     <div>
                                                         <label for="title" class="col-form-label">Tiêu đề:</label>
                                                         <input type="text" name="title" class="form-control" value="<%=sections[0][0].sec_title%>" required>
                                                     </div>
                                                     <div>
                                                         <label for="des" class="col-form-label">Mô tả:</label>
                                                         <input type="text" name="des" class="form-control" value="<%=sections[0][0].sec_desc%>" required>
                                                     </div>
                                                     <div class="modal-footer">
                                                       <input type="submit" class="btn btn-success" value="Xác nhận">
                                                     </div>
                                               </form>
                                         </div><br>
                                     </div>
                                 </div>
                             </div>
      <div class="card" style="border-radius: 10px;">
        <div class="card-header d-inline" style="background-color: #888;border-top-left-radius: 6px;border-top-right-radius: 6px;">
          <h5>Danh sách câu hỏi<h5>
          <!-- <div class="dropdown" class="text-right">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Danh sách lựa chọn
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="/survey">Danh sách phiếu khảo sát</a>
            </div>
          </div> -->

        </div>
        <div class="card-body" style="background-color: #dddddd;border-bottom-left-radius: 6px;border-bottom-right-radius: 6px;">
          <div class="row" style="margin-bottom: 3%;">
            <div class="col-12 col-sm-5 col-md-5" >
              <div class="row" >
                  <div class="col-9 col-sm-8 col-md-8" >
                    <input type="tim" class="form-control" id="search2" placeholder="Tìm kiếm ...">
                  </div>
                  <div class="col-1 col-sm-1 col-md-1">
                    <button class="btn btn-outline-secondary" type="submit">Search</button>
                  </div>
              </div>
            </div>
            <div class="col-12 col-sm-7 col-md-7">
            <form method="POST" action="/new_session?id=<%=sections[0][0].section_id%>">
              <div class="row">
                  <div class="col-8 col-sm-9 col-md-9">
                    <textarea type="text" name="context" rows="1" class="form-control" id="search2" placeholder="Đặt câu hỏi ..."></textarea> 
                  </div>
                  <div class="col-1 col-sm-1 col-md-1">
                    <input class="btn btn-outline-secondary" type="submit" value="Gửi" >
                  </div>
              </div>
            </form>
            </div>
          </div>
          <% sections[1].forEach(function(section) { %>
          <div class="card" style="border-radius: 6px;">
            <div class="row padding">
              <div class="col-3 col-sm-3 col-md-2">
                <div class="card" style="border-top-left-radius: 6px;border-bottom-left-radius: 6px;">
                  <a href="/question?question_id=<%=section.question_id%>">
                   <img class="card-img-top" src="./images/logo2.jpg" style="border-top-left-radius: 6px;border-bottom-left-radius: 6px;">
                 </a>
               </div>
             </div>
             <div class="col-9 col-sm-9 col-md-9">
              
              <div class="card-body">
                <h5 class="card-title"><a href="/question?question_id=<%=section.question_id%>"><%= section.context%></a></h5>
                <p class="card-text"><br>
                  Đăng bởi: <a href="/yourprofile?id=<%=section.user_id%>"> <%= section.name%></a>
                  <%= section.date_posted%>
                </p>
              </div>
            </div>
            <% if (section.username == session.username) { %>
            <div style="float: right;" class="dropdown">
                  <a class="nav-link dropdown-toggle" style="color: black" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></a>
                <div class="dropdown-menu">
                  <a class="dropdown-item" href="#">Chỉnh sửa</a>
                  <a class="dropdown-item" href="/deletesection?question_id=<%=section.question_id%>&section_id=<%=sections[0][0].section_id%>">Xóa</a>
                </div>
              </div>
              <% } %>
          </div>
        </div><br>
        <% }); %>

  </div>
</div>
<p style="padding-top: 50px; float: right;"><a href="#">Back to top</a></p>
</div>

<%- include update_inf_user %>

</main>
<footer id="footer">
  <ul style="padding: 15px; margin-bottom: 0px;">
    <h2 style="padding-bottom: 0px;text-decoration: none;">Hệ thống hỏi - đáp Q&A</h2>

    <p style="font-size: 12px"> @2019 design by Team 5</p>
  </ul>
</footer>
<script type="text/javascript">
  var textarea = document.querySelector('textarea');

textarea.addEventListener('keydown', autosize);
             
function autosize(){
  var el = this;
  setTimeout(function(){
    el.style.cssText = 'height:auto; padding:6px';
    // for box-sizing other than "content-box" use:
    // el.style.cssText = '-moz-box-sizing:content-box';
    el.style.cssText = 'height:' + el.scrollHeight + 'px';
  },0);
}
</script>
</body>
</html>
